<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <script src="https://d3js.org/d3.v3.min.js"></script>
    <title>Document</title>
</head>
<body>
    <h1>Hw3-1</h1>
    <input type="button" value="新增" onclick="update()">
    <input type="button" value="移除" onclick="remove()">

    <script>
        var grade = [85, 60, 99, 49, 77, 82];
        var width = 600;
        var height = 300;
        var padding = {
            "left": 100,
            "right": 100,
            "top": 100,
            "bottom": 100
        };
        var slice = 40;
        
        //增加畫布
        addSvg();

        //綁定
        binder(grade);

        //給定資料
        render();

        function addSvg(){
            d3.select("body")
                .append("svg")
                .attr({
                    "width": width,
                    "height": height,
                })
                .style({
                    "border": "1px solid gray"
                })
        };

        function binder(data){
            var rect = d3.select("svg")
                        .selectAll("rect")
                        .data(data);
            rect.enter()
                .append("rect");

            rect.exit()
                .remove();

            var text = d3.select("svg")
                            .selectAll("text")
                            .data(data);
            text.enter()
                .append("text");
            
            text.exit()
                .remove();
        };

        function render(){
            d3.selectAll("rect")
                .attr({
                    "x": function(d, i){
                        return padding.left + (slice + 10) * i;
                    },
                    "y": function(d, i){
                        return height - padding.bottom - d;
                    },
                    "width": slice,
                    "height": function(d){
                        return d;
                    },
                    "fill": function(d){
                        return d < 70 ? "red" : "lightgreen";
                    }
                });
            
            d3.selectAll("text")
                .attr({
                    "x": function(d, i){
                        return padding.left + (slice + 10) * i + 10;
                    },
                    "y": function(d){
                        return height - padding.bottom + 15;
                    }
                })
                .text(function(d){
                    return d;
                });
        };

        function random(m, n){
            return Math.ceil(Math.random() * (m - n) + n);                    
        }

        function update(){
            grade.push(random(100, 0))
            binder(grade);
            render()
        };

        function remove(){
            grade.pop();
            binder(grade);
            render();
        }


    </script>
    <hr>
    <h1>Hw3-2</h1>
    <p></p>
    <script>
         var index = ["中國國民黨", "民主進步黨", "時代力量", "無黨團結聯盟", "親民黨"];
         var color =  ["red", "blue", "green", "gray", "black"];

         var xScale = d3.scale
                        .ordinal()
                        .domain(index)
                        .range(color);
         console.log(xScale("無黨團結聯盟"));
         d3.select("p")
            .text("除了可以在主控台看之外，另外將文字show在文件上，顏色為 ： " + xScale("無黨團結聯盟"));
    </script>
</body>
</html>